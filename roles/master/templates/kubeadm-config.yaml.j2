apiVersion: kubeadm.k8s.io/v1beta1
kind: ClusterConfiguration
kubernetesVersion: stable
bootstrapTokens:
- groups:
  - system:bootstrappers:kubeadm:default-node-token
  token: {{ kubeadm_token.stdout }}
  ttl: 24h0m0s
  usages:
  - signing
  - authentication
etcd:
    external:
        endpoints:
        {% for h in groups['etcd'] %}
        - https://{{ hostvars[h].ansible_default_ipv4.address }}:2379
        {% endfor %}
        caFile: /etc/kubernetes/pki/etcd/ca.crt
        certFile: /etc/kubernetes/pki/apiserver-etcd-client.crt
        keyFile: /etc/kubernetes/pki/apiserver-etcd-client.key
